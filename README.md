# mall-tiny

借鉴[GitHub](https://github.com/macrozheng/mall)开源项目经验的学习版本，使用的SpringBoot版本为3.0，MySQL为8.0版本，将从头开始构建一个具有前台展示和后台管理功能的商城系统



# 需求分析

## 用户登录/注册

用户注册和登录是每个系统必备的功能

**注册功能**

注册必须的字段如下表，请求方式POST，成功后返回用户名

| 字段     | 要求                                    | 说明                   | 类型   |
| -------- | --------------------------------------- | ---------------------- | ------ |
| username | 不能重复，必须大于6个字符且小于20个字符 | 用户名，作为登录时账号 | String |
| phone    | 必须符合中国手机号的标准                | 手机号，消息提醒使用   | String |
| password | 8-20位，至少包含数字与字母              | 密码，作为登录时密码   | String |
| gender   | 必须选择男或者女，0-> 女 / 1-> 男       | 性别                   | Byte   |

**点击注册后，应该出现相应的提示，并且防止用户发送重复的请求**

后端实现：在前端发送POST请求后，使用RegisterDTO对象接收

+ 首先使用分布式锁对用户名上锁，防止重复的用户名注册
+ 验证所有字段是否不为空，存在为空则抛出异常
+ 验证是否存在同名用户，存在则抛出异常，
+ 往数据库插入数据，更新上面四条数据以外，还要更新创建时间，成功返回用户名



**登录功能**

使用字段如下，请求方式POST，成功后返回token

| 字段     | 说明         |
| -------- | ------------ |
| username | 注册时用户名 |
| password | 注册时密码   |

**点击登录后，应该出现相应的提示，防止用户重复登录**

后端实现：前端发送POST请求，使用LoginDTO对象接收

+ 验证是否存在空字段，存在则抛出异常
+ 验证账户是否存在且处于启用状态，未启用则抛出异常
+ 验证账号密码是否匹配，不匹配则抛出异常
+ 验证通过，往Redis中存入Member对象的JSON字符串，key为Token，实现单点登录



## 用户个人信息的修改

+ 使用GET请求，获取当前的个人信息
+ 使用POST请求，发送修改后的信息，成功后返回新的个人信息

在用户完成登录操作后，点击`头像`或者`个人主页`等链接，应跳转至个人主页，个人主页中应该存在`修改信息`的功能，修改信息的过程中，应该为`多次修改一次提交`，下面是能修改的个人信息

| 字段      | 要求                                  | 说明                                         | 类型      |
| --------- | ------------------------------------- | -------------------------------------------- | --------- |
| nickname  | 至少大于3个字符，小于20个字符         | 用户昵称，作为聊天界面，评论等显示的标识     | String    |
| avatar    | 文件名不包含中文                      | 用户头像，从COS获取图片的key（图片的文件名） | String    |
| gender    | 必须选择男或者女，0-> 女 / 1-> 男     | 用户性别                                     | Byte      |
| birthday  | 格式必须符合'YYYY-MM-DD'              | 用户生日                                     | LocalDate |
| city      | 推荐格式为'省份-城市'，国家默认为中国 | 用户所在地                                   | String    |
| job       | 无                                    | 用户职业                                     | String    |
| signature | 少于200个字符                         | 用户个性签名，个人简介                       | String    |

前端实现：

+ `更新后应该将新的信息同步到缓存中`
+ 对于birthday，city等存在固定格式的数据，`建议使用下拉列表等固定选择形式`来供用户进行选择
+ 对于头像上传可能的优化策略，异步实现，即使用一个线程来单独负责头像的上传，使用另一个线程向后端发送数据，在上传头像后应该显示出效果
+ 其他可能的优化
    + 对于常用信息的缓存，如头像，token，昵称
    + 前端图片的裁切，修改，规定图片的大小如（256 x 256）
    + 前端对于太大的图片（大于5M）进行压缩后上传

![avatar.drawio](https://cdn.jsdelivr.net/gh/Aurora0201/ImageStore@main/img/upgit_20230421_1682059422.png)

后端实现：

+ 首次请求，应该向前端发送当前的用户信息，使用GET请求，发送MemberInfoDTO对象
+ 前端使用POST请求向后端发送更新后的数据，后端先对数据库进行更新，然后更新Redis缓存中的数据



## 用户密码修改

用户应该具有修改密码的权利

要求：

+ 使用POST请求
+ 请求时携带Token

实现功能所需的字段

| 字段        | 要求                       | 说明         | 类型   |
| ----------- | -------------------------- | ------------ | ------ |
| oldPassword | 8-20位，至少包含数字与字母 | 旧的用户密码 | String |
| newPassword | 8-20位，至少包含数字与字母 | 新的用户密码 | String |

前端实现：

+ 首先需要输入原来的密码
+ 然后输入新的密码并进行重复确认
+ 向后端发送请求由后端进行旧密码确认

后端实现：

+ 验证旧密码是否正确，错误则抛出异常
+ 更新数据库
+ 更新Redis缓存



## 商家注册

商家是出售商品的一方，tiny商城提供了用户注册为商家的功能，即用户可以创建一个店铺，并获得店铺的一系列管理功能，如为店铺添加、删除商品，设置店铺主页轮播图，设置秒杀活动等等，这里我们先实现注册店铺的功能

要求：

+ 使用POST请求
+ 携带token

